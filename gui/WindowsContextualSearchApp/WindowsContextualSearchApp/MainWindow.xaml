<Window x:Class="WindowsContextualSearchApp.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Windows Contextual Search" Height="720" Width="1200"
        WindowStartupLocation="CenterScreen"
        Background="#0B0F14">
    <Window.Resources>
        <!--Dark theme-->
        <SolidColorBrush x:Key="Card" Color="#131A22"/>
        <SolidColorBrush x:Key="CardBorder" Color="#223043"/>
        <SolidColorBrush x:Key="Accent" Color="#3B82F6"/>

        <Style TargetType="GroupBox">
            <Setter Property="Margin" Value="6"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="Foreground" Value="#E5E7EB"/>
            <Setter Property="Background" Value="{StaticResource Card}"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
        </Style>

        <Style TargetType="TextBlock">
            <Setter Property="Foreground" Value="#E5E7EB"/>
        </Style>

        <Style TargetType="TextBox">
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Padding" Value="6"/>
        </Style>

        <Style TargetType="Button">
            <Setter Property="Margin" Value="4"/>
            <Setter Property="Padding" Value="8,6"/>
            <Setter Property="Foreground" Value="#E5E7EB"/>
            <Setter Property="Background" Value="#1F2937"/>
            <Setter Property="BorderBrush" Value="{StaticResource CardBorder}"/>
        </Style>

        <!-- Hyperlink style for citation hover -->
        <Style TargetType="Hyperlink">
            <Setter Property="Foreground" Value="#60A5FA"/>
            <Setter Property="TextDecorations" Value="None"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="#93C5FD"/>
                    <Setter Property="TextDecorations" Value="Underline"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!--header-->
            <RowDefinition Height="Auto"/>
            <!--prompt-->
            <RowDefinition Height="Auto"/>
            <!--advanced-->
            <RowDefinition/>
            <!--main area-->
            <RowDefinition Height="Auto"/>
            <!--status-->
        </Grid.RowDefinitions>

        <!--Header:data folder + API base URL-->
        <DockPanel Grid.Row="0" LastChildFill="True" Margin="0,0,0,6">
            <StackPanel Orientation="Horizontal" DockPanel.Dock="Left">
                <TextBlock Text="Data folder:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox x:Name="DataFolderBox" Width="420"/>
                <Button Content="Browse…" Click="BrowseFolder_Click"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <TextBlock Text="API:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                <TextBox x:Name="ApiBaseBox" Width="260" Text="http://127.0.0.1:8000"/>
                <Button Content="Check" Click="HealthCheck_Click"/>
            </StackPanel>
        </DockPanel>

        <!--Prompt row-->
        <Grid Grid.Row="1" Margin="0,0,0,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="140"/>
            </Grid.ColumnDefinitions>

            <TextBox x:Name="PromptBox"
                     Grid.Column="0"
                     Height="44"
                     FontSize="14"
                     VerticalContentAlignment="Center"
                     Padding="12,0,12,0"
                     AcceptsReturn="False"
                     TextWrapping="NoWrap"/>

            <Button Grid.Column="1"
                    Content="Search"
                    Height="44"
                    Margin="8,0,0,0"
                    Click="Search_Click"/>
        </Grid>

        <!--Advanced settings-->
        <Expander Grid.Row="2" Header="Advanced settings" IsExpanded="False" Background="{StaticResource Card}" Foreground="White">
            <StackPanel Orientation="Horizontal" Margin="6">
                <TextBlock Text="Engine:" VerticalAlignment="Center"/>
                <ComboBox x:Name="EngineBox"
                          Width="160"
                          MinHeight="28"
                          Padding="6,0,6,0"
                          VerticalContentAlignment="Center"
                          SelectionChanged="EngineBox_SelectionChanged">
                    <ComboBox.ItemContainerStyle>
                        <Style TargetType="ComboBoxItem">
                            <Setter Property="VerticalContentAlignment" Value="Center"/>
                            <Setter Property="Padding" Value="6,2"/>
                        </Style>
                    </ComboBox.ItemContainerStyle>
                    <ComboBoxItem Content="LLM Agent" IsSelected="True"/>
                    <ComboBoxItem Content="Router"/>
                </ComboBox>

                <StackPanel x:Name="StepsWrap" Orientation="Horizontal" Visibility="Collapsed">
                    <TextBlock Text="  Steps:" VerticalAlignment="Center"/>
                    <TextBox x:Name="StepsBox" Width="50" Text="4"/>
                </StackPanel>

                <TextBlock Text="  K:" VerticalAlignment="Center"/>
                <TextBox x:Name="KBox" Width="50" Text="6"/>
                <TextBlock Text="  CK:" VerticalAlignment="Center"/>
                <TextBox x:Name="CKBox" Width="50" Text="8"/>
                <TextBlock Text="  BK:" VerticalAlignment="Center"/>
                <TextBox x:Name="BKBox" Width="50" Text="20"/>

                <TextBlock Text="  Before (YYYY-MM-DD):" VerticalAlignment="Center" Margin="16,0,0,0"/>
                <TextBox x:Name="BeforeBox" Width="120" ToolTip="Optional"/>
            </StackPanel>
        </Expander>

        <!--Main content area (Answer + Logs only, full width)-->
        <Grid Grid.Row="3">
            <Grid.RowDefinitions>
                <RowDefinition Height="2*"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!--Answer section-->
            <GroupBox Header="Answer" Grid.Row="0">
                <DockPanel>
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="4">
                            <TextBlock x:Name="AnswerText" TextWrapping="Wrap" FontSize="14" />
                            <ItemsControl x:Name="CitationsPanel" Margin="0,8,0,0">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Margin="0,2,0,2">
                                            <Hyperlink Click="Citation_Click">
                                                <Run Text="{Binding Path}" />
                                            </Hyperlink>
                                        </TextBlock>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </ScrollViewer>
                </DockPanel>
            </GroupBox>

            <!--Logs section-->
            <GroupBox Header="Logs" Grid.Row="1">
                <TextBox x:Name="LogBox" Background="#0F1720" Foreground="#9CA3AF" IsReadOnly="True"
                         TextWrapping="Wrap" VerticalScrollBarVisibility="Auto"/>
            </GroupBox>
        </Grid>

        <!--Status bar-->
        <StatusBar Grid.Row="4" Background="#0F1720">
            <StatusBarItem>
                <TextBlock x:Name="StatusText" Text="Ready"/>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
